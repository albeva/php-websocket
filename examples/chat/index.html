<html>
	<head>
		<title>WebSocket</title>
		<style>
			html,body{font:normal 0.9em arial,helvetica;}
			#log {width:440px; height:400px; border:1px solid #7F9DB9; overflow:auto;}
			#msg {width:330px;}
			span.user {
				font-weight : bold;
			}
		</style>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js" type="text/javascript"></script>
		<script type="text/javascript" src="web-socket-js/swfobject.js"></script>
		<script type="text/javascript" src="web-socket-js/web_socket.js"></script>
		<script type="text/javascript">
			// the socket object var
			var socket;
			
			// create the socket
		    // Set URL of your WebSocketMain.swf here:
		    window.WEB_SOCKET_SWF_LOCATION = "web-socket-js/WebSocketMain.swf";
		    // Set this to dump debug message from Flash to console.log:
		    window.WEB_SOCKET_DEBUG = true;
			
			// initalize
			function init(){
				var host = "ws://localhost:12345?hi=1&a[]=1&a[]=2";
				try {
					
					var name = "User " + Math.floor(Math.random() * 1000);
				
					var WsClass = window.MozWebSocket || window.WebSocket;
					socket = new WsClass(host);
					// on open
					socket.onopen    = function(msg){
						log("Welcome - " + name);
						// send our name
						try {
							var json = JSON.stringify({name : name});
							socket.send(json);
						} catch(ex) {
							log(ex);
						}
					};
					// on message
					socket.onmessage = function(msg) {
						var data = $.parseJSON(msg.data);
						
						// got a new message
						if (data.message) {
							log('<span class="user id-' + data.id + '">' + data.user + '</span> ' +
							data.message);
						}
					};
					// on disconnect
					socket.onclose   = function(msg){
						log("Disconnected - status " + this.readyState);
						socket.close();
						socket = null;
					};
				} catch(ex) {
					log(ex);
				}
				// focus the input field
				$("#msg").focus();
			}
			
			// send the message
			function send(){
				// get the message
				var el = $("#msg");
				var msg = el.val();
				if(!msg) return;
				// reset the input box
				el.val('');
				el.focus();
				// send
				try {
					var json = JSON.stringify({message : msg});
					socket.send(json);
				} catch(ex) {
					log(ex);
				}
			}
			// disconnect
			function quit(){
				log("Goodbye!");
				socket.close();
				socket=null;
			}
			// log the message
			function log(msg) {
				var el = $("#log");
				el.append('<div>' + msg + '</div>');
				el.scroll();
			}
			// trap enter key
			function onkey(event){
				if(event.keyCode==13){
					send();
				}
			}
			
			// when ready
		</script>
	</head>
	<body onload="init()">
		<h3>Web sockets</h3>
		<div id="log"></div>
		<input id="msg" type="textbox" onkeypress="onkey(event)" />
		<button onclick="send()">Send</button>
		<button onclick="quit()">Quit</button>
	</body>
</html>
